<style>
.t-aside{
	-webkit-transition: -webkit-transform .3s ease-in-out;
    transition: transform .3s ease-in-out;
}
.t-aside.open{
    -webkit-transform: translateX(0);
    transform: translateX(0);
}
</style>

<template>
<div class="t-aside" v-class="'t-aside--'+from,open:show" v-el="sidebar">
	<content></content>
</div>
<div class="t-aside-dimmer" v-show="show" v-on="click:close($event)"></div>
</template>

<script>
module.exports = {
	data : function(){
		return {
			name : 'aside-fix',
			top : 0,
			sidebarWidth : 0
		}
	},
	props : {
		show : {
			type : Boolean,
			default : false
		},
		//push or open
		type : {
			type : String,
			default : 'open'
		},
		from : {
			type : String,
			default : 'left'
		}
	},
	watch : {
		'show' : function(val){
			if (val) {

				if (!this.sidebarWidth) this.sidebarWidth = this.$$.sidebar.getBoundingClientRect().width;

				this.fix(val);	
			}
		}
	},
	created : function(){
		if (this.type === 'push') this.from = 'left';
	},
	methods : {
		/**
		 * [close this component]
		 * @param  {[type]} e [description]
		 * @return {[type]}   [description]
		 */
		close : function(e){
			var that = this;
			if (e.target.className === 't-aside-dimmer') {
				that.show = false;
				this.fix(false);
			}
		},
		/**
		 * [As the aside opened, fix body position]
		 * @return {[type]} [description]
		 */
		fix : function(data){
			var that = this,
				_html = document.documentElement,
				_body = document.body;


			if (data) {

				that.top = _body.scrollTop; //cache scrollTop

				that.setHtmlStyle(_html, that.top);

				that.setBodyStyle(_body, _html.getBoundingClientRect().width, window.screen.height);

				if (that.type === 'push') that.setPush(_body);
				
			} else {

				if (that.type === 'push') that.setPush(_body, 1);;
				//wait transiton end
				setTimeout(function(){

					that.setHtmlStyle(_html);
					that.setBodyStyle.call(that, _body);
				}, 400);
				
			}			

		},
		/**
		 * [setPush description]
		 * @param {[type]} b [document.body]
		 */
		setPush : function(b, s){
			b.style.marginLeft = s ? 0 : this.sidebarWidth + 'px';
		},
		setHtmlStyle : function(target, top){
			target.style.marginTop = top ? '-' + top + 'px' : '';
		},
		/**
		 * [setBodyStyle description]
		 * @param {[type]} w [width]
		 * @param {[type]} h [height]
		 * @param {[type]} t [scrollTop]
		 */
		setBodyStyle : function(b, w, h){
			
			if (w) {		
			
				b.style.width = w + 'px';
				b.style.height = h + 'px';
				b.classList.add(this.name);
			} else {

				b.style.cssText = '';
				b.classList.remove(this.name);
				b.scrollTop = this.top;
			};
		}
	}

}
</script>